# üó∫Ô∏è Roadmap - Renegade Dungeon Game

## ‚úÖ Completado Hoy (24 Nov 2024)

### Sistema de Turnos Individual
- [x] Creada clase [TurnEntity](file:///c:/dev/renegade_dungeon_game/lib/models/turn_entity.dart#3-16) para representar combatientes
- [x] Implementado sistema de iniciativa individual (cada personaje tira su propia iniciativa)
- [x] Sistema de cola de turnos (`turnQueue`) con orden basado en iniciativa
- [x] M√©todo [nextTurn()](file:///c:/dev/renegade_dungeon_game/lib/game/renegade_dungeon_game.dart#167-205) para avanzar turnos autom√°ticamente
- [x] Eliminaci√≥n correcta de enemigos derrotados de la cola
- [x] Sincronizaci√≥n entre `currentEnemy` y la cola de turnos

### Correcciones de Bugs
- [x] **Victoria Falsa**: Arreglado el bug donde aparec√≠a pantalla de Victoria al matar un enemigo en combate multi-enemigo
- [x] **Renumeraci√≥n de Enemigos**: Implementados IDs permanentes (Enemigo #2 sigue siendo #2 aunque mates al #1)
- [x] **Combate √önico No Termina**: Corregido bug donde combates 1v1 se quedaban bloqueados
- [x] **HP en 0 Despu√©s de Morir**: Arreglada sincronizaci√≥n de `combatStats` al reaparecer
- [x] **Guardia Hace Da√±o**: Corregido para que habilidades defensivas NO da√±en al jugador
- [x] **Loot Multi-Enemy**: Arreglado para que acumule items de TODOS los enemigos derrotados

### Sistema de Combate
- [x] Unificado sistema de combate (todo usa [startNewCombatMulti](file:///c:/dev/renegade_dungeon_game/lib/game/renegade_dungeon_game.dart#94-166))
- [x] Diferenciaci√≥n entre habilidades ofensivas y defensivas
- [x] Logs mejorados con nombres permanentes de enemigos

---

## üöß Pendiente / Pr√≥ximos Pasos

### Alta Prioridad üî¥

#### 1. Configurar Zonas en Tiled (dungeon.tmx)
**Problema Actual**: No hay capa de SpawnZones, por eso aparecen enemigos incorrectos en zonas equivocadas.

**Acci√≥n Requerida**:
1. Abrir [assets/tiles/dungeon.tmx](file:///c:/dev/renegade_dungeon_game/assets/tiles/dungeon.tmx) en Tiled
2. Crear capa de objetos llamada [SpawnZones](file:///c:/dev/renegade_dungeon_game/lib/game/renegade_dungeon_game.dart#1108-1159)
3. Dibujar rect√°ngulos para cada zona:
   - **Ciudad Segura** (safe zone)
   - **Bosque Claro** (low zone - slime)
   - **Zona Media** (medium zone - goblin)
   - **Cuevas/Mazmorras** (high zone - bat, skeleton, goblin)

4. Para cada rect√°ngulo, a√±adir propiedades:
```
name: String = "Nombre de la Zona"
enemyTypes: String = "slime" o "goblin" o "bat,skeleton,goblin"
dangerLevel: String = "safe" / "low" / "medium" / "high"
encounterChance: float = 0.02 (2% por paso)
minLevel: int = 1
maxLevel: int = 99
```

**Alternativa**: Si no quieres configurar en Tiled, puedo crear un sistema de zonas hardcodeado.

#### 2. Sistema de Buffs/Debuffs
**Problema**: La habilidad "Guardia" no aplica ning√∫n buff de defensa.

**Tareas**:
- [ ] Crear clase `StatusEffect` (buff/debuff)
- [ ] A√±adir sistema de efectos temporales a [CombatStats](file:///c:/dev/renegade_dungeon_game/lib/models/combat_stats.dart#5-86)
- [ ] Implementar buff de defensa para "Guardia"
- [ ] Agregar indicador visual de buffs activos en UI

#### 3. Balance de Combate
**Observaciones**: Revisar si el sistema de turnos est√° balanceado.

**Tareas**:
- [ ] Ajustar valores de iniciativa (speed) de enemigos
- [ ] Verificar que el scaling de grupo (70%/60% stats) funcione bien
- [ ] Testear combates 1v1, 1v2, 1v3 para balance

### Prioridad Media üü°

#### 4. Quests & Story System üìñ
**Por qu√© es importante**: Sin misiones, el juego es solo "caminar y pelear aleatoriamente".

**Tareas**:
- [ ] Sistema b√°sico de quests (objectives, completion tracking)
- [ ] Quest log UI
- [ ] NPCs con di√°logos
- [ ] Quest markers en el mapa
- [ ] Al menos 3-5 side quests
- [ ] Main quest b√°sica (inicio, medio, final)

#### 5. UI de Combate Mejorada
**Mejoras Posibles**:
- [ ] Mostrar orden de turnos (qui√©n va despu√©s)
- [ ] Indicador de turno actual m√°s visible
- [ ] Barra de iniciativa o timeline
- [ ] Animaciones de entrada/salida de turnos

#### 5. Sistema de Estados (Status Effects)
**Efectos a Implementar**:
- [ ] Veneno (da√±o por turno)
- [ ] Paralizado (skip turn)
- [ ] Buff de Ataque/Defensa
- [ ] Regeneraci√≥n

#### 6. M√°s Habilidades para Enemigos
**Enemigos que necesitan m√°s habilidades**:
- [ ] Bat: Solo tiene "Picotazo", agregar habilidad de evasi√≥n
- [ ] Slime: Solo tiene "Salto", agregar divisi√≥n o autoheal
- [ ] A√±adir habilidades √∫nicas por enemigo

### Prioridad Baja üü¢

#### 7. Sistema de Dificultad Adaptativa
- [ ] Ajustar encuentros seg√∫n nivel del jugador
- [ ] Zonas que escalan con el nivel
- [ ] Enemigos elite/raros con mejor loot

#### 8. Mejoras Visuales
- [ ] Efectos de part√≠culas en ataques
- [ ] Screen shake en golpes cr√≠ticos
- [ ] Animaciones de habilidades especiales
- [ ] Indicadores de da√±o flotantes

#### 9. Tutorial/Onboarding
- [ ] Tutorial de combate b√°sico
- [ ] Explicaci√≥n de sistema de turnos
- [ ] Tips contextuales

---

## üîß Consideraciones T√©cnicas (Transversal)

### Performance & Optimization ‚ö°
**Cu√°ndo empezar**: Phase 6-7

- [ ] Profile performance con DevTools
- [ ] Implementar object pooling
- [ ] Optimizar sprite loading
- [ ] Target: 60fps en web, 30fps m√≠nimo en mobile

### Testing & QA üß™
**Cu√°ndo empezar**: Phase 5

- [ ] Unit tests para damage calculations
- [ ] Playtesting con 5+ personas
- [ ] Bug tracking en GitHub Issues
- [ ] List de "known issues" p√∫blica

### Platform Strategy üì±
**Decisi√≥n requerida**: Phase 5

**Pregunta clave**: ¬øWeb, Mobile, Desktop, o todos?
- Empezar con Web (m√°s f√°cil)
- Mobile requiere UI touch-friendly
- Desktop permite controles m√°s complejos

### Art Pipeline üé®
**Planear**: Phase 5-6

**Opciones**:
1. Comprar asset packs ($20-50)
2. Contratar pixel artist ($$)
3. Aprender pixel art (tiempo)
4. Mezcla de los anteriores

**Recomendaci√≥n**: Asset packs + modificaciones custom

### Technical Debt üîß
**Continuous**: 15% tiempo cada semana

- [ ] Weekly cleanup day (resolver lints)
- [ ] Refactor c√≥digo duplicado
- [ ] Documentar sistemas complejos
- [ ] Mantener README actualizado

---

## üêõ Bugs Conocidos (No Cr√≠ticos)

- [ ] **Lints pendientes**: Varios imports sin usar en componentes de enemigos
- [ ] **Unnecessary cast** en l√≠nea 621 de [renegade_dungeon_game.dart](file:///c:/dev/renegade_dungeon_game/lib/game/renegade_dungeon_game.dart)
- [ ] Verificar que [_removeDefeatedEnemy](file:///c:/dev/renegade_dungeon_game/lib/game/renegade_dungeon_game.dart#533-575) actualice correctamente `currentTurnIndex`

---

## üìù Notas T√©cnicas

### Archivos Clave Modificados Hoy
- [lib/models/turn_entity.dart](file:///c:/dev/renegade_dungeon_game/lib/models/turn_entity.dart) - NUEVO
- [lib/game/renegade_dungeon_game.dart](file:///c:/dev/renegade_dungeon_game/lib/game/renegade_dungeon_game.dart) - Refactorizado CombatManager
- [lib/ui/combat_ui.dart](file:///c:/dev/renegade_dungeon_game/lib/ui/combat_ui.dart) - Actualizado para usar `currentEnemyNotifier`

### Sistema de Turnos - C√≥mo Funciona
1. Al iniciar combate: Se calcula iniciativa de todos (player + enemies)
2. Se crea `turnQueue` ordenado por iniciativa (mayor ‚Üí menor)
3. [nextTurn()](file:///c:/dev/renegade_dungeon_game/lib/game/renegade_dungeon_game.dart#167-205) avanza por la cola, cicla al final
4. Enemigos derrotados se eliminan de la cola
5. Combate termina cuando `currentEnemies.isEmpty`

### Sincronizaci√≥n HP
- `player.stats.currentHp` = HP en exploraci√≥n
- `player.stats.combatStats.currentHp` = HP en combate (UI lo usa)
- Deben sincronizarse en:
  - Inicio de combate
  - Al tomar da√±o
  - Al morir/reaparecer

---

## üéØ Para Tu Sesi√≥n en PC

### Recomendaci√≥n de Orden
1. **Primero**: Configurar zonas en Tiled (30-45 min)
2. **Segundo**: Implementar sistema de buffs b√°sico para "Guardia" (1-2 horas)
3. **Tercero**: Testear y balancear el sistema de turnos (30 min)
4. **Despu√©s**: Mejoras de UI o m√°s habilidades seg√∫n prefieras

### Comandos √ötiles
```bash
# Hot reload (r) despu√©s de cambios
r

# Restart completo (R) si hay problemas
R

# Ver an√°lisis de c√≥digo
flutter analyze

# Correr tests (si los creas)
flutter test
```

### Archivos a Tener Abiertos
- [lib/game/renegade_dungeon_game.dart](file:///c:/dev/renegade_dungeon_game/lib/game/renegade_dungeon_game.dart) - CombatManager
- [lib/models/ability_database.dart](file:///c:/dev/renegade_dungeon_game/lib/models/ability_database.dart) - Habilidades
- [lib/ui/combat_ui.dart](file:///c:/dev/renegade_dungeon_game/lib/ui/combat_ui.dart) - UI de combate
- [assets/tiles/dungeon.tmx](file:///c:/dev/renegade_dungeon_game/assets/tiles/dungeon.tmx) - Mapa en Tiled

---

¬°Todo est√° listo para continuar! üöÄ
